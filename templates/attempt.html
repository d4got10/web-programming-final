{% from 'header.html' import header %}
<!DOCTYPE html>
<html lang="ru">
{{ header("Каталог", current_user) }}
<body>
<div class="container-fluid">
    <div class="row flex-nowrap">
        <div class="col-md-2 col-xl-2 px-0 bg-dark d-flex flex-column align-items-center align-items-sm-start text-white"
             style="height: 94vh">
            <div class="w-100 pt-4 pb-4 p-2">
                <p>{{ course.name }}</p>
                <p>Дата начала: {{ attempt.start_date }}</p>
                <p id="timer"></p>
            </div>
            <ul class="nav nav-pills flex-column mb-sm-auto mb-0 w-100 align-items-center align-items-sm-start"
                id="menu">
                {% for task in task_list %}
                    {% if task in completed_task_list %}
                        <li class="nav-item border-bottom border-top border-light bg-success text-center w-100 pt-3 pb-3 border-bottom">
                            <a class="text-white"
                               href="{{ url_for('attempt', id=attempt.id, selected_task=loop.index) }}">{{ task.name }}</a>
                        </li>
                    {% elif task in failed_task_list %}
                        <li class="nav-item border-bottom border-top border-light bg-danger text-center w-100 pt-3 pb-3 border-bottom">
                            <a class="text-white"
                               href="{{ url_for('attempt', id=attempt.id, selected_task=loop.index) }}">{{ task.name }}</a>
                        </li>
                    {% else %}
                        <li class="nav-item border-bottom border-top border-light text-center w-100 pt-3 pb-3 border-bottom">
                            <a class="text-white"
                               href="{{ url_for('attempt', id=attempt.id, selected_task=loop.index) }}">{{ task.name }}</a>
                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
        <div class="col py-3">
            {% if selected_task_status == 'none' %}
                <p>Пока не отвечали</p>
            {% elif selected_task_status == 'completed' %}
                <p class="text-success">Так держать!</p>
            {% elif selected_task_status == 'failed' %}
                <p class="text-danger">Не правильно!</p>
            {% endif %}
            {% if selected_task.task_type == 1 %}
                <p>Задание с одним вариантом ответа</p>
                <p>{{ selected_task.description }}</p>
                <form action="{{url_for('attempt', id=attempt.id, selected_task=selected_task_id) }}" method="post">
                    <input type="hidden" name="task" value="{{ selected_attempt_task.id }}">
                    {% for answer in answers %}
                        <input type="radio" name="answer" value="{{ answer.value }}"> {{ answer.value }} <br>
                    {% endfor %}
                    <input type="submit" value="Отправить">
                </form>
            {% elif selected_task.task_type == 2 %}
                <p>Задание с несколькими вариантами ответа</p>
                <p>{{ selected_task.description }}</p>
                {% for answer in answers %}
                    <p>{{ answer.value }}</p>
                {% endfor %}
            {% else %}
                <p>Задание с текстовым ответом</p>
                <p>{{ selected_task.description }}</p>
                {% for answer in answers %}
                    <p>{{ answer.value }}</p>
                {% endfor %}
            {% endif %}
        </div>
    </div>
</div>
<script>
    const countDownDate = new Date("{{ attempt.end_date }}").getTime();

    const update_time = function () {

        var now = new Date().getTime();

        var distance = countDownDate - now;

        var days = Math.floor(distance / (1000 * 60 * 60 * 24));
        var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);

        document.getElementById("timer").innerHTML = "Осталось: " + days + "д " + hours + "ч "
            + minutes + "м " + seconds + "с ";

        if (distance < 0) {
            clearInterval(x);
            document.getElementById("timer").innerHTML = "Завершено";
        }
    }

    update_time()
    // Update the count down every 1 second
    const x = setInterval(update_time, 1000);
</script>
</body>
</html>